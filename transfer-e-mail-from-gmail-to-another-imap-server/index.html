<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Transfer e-mail from GMail to another IMAP server | oskarhane.com</title>
  <meta name="author" content="Oskar Hane">
  
  <meta name="description" content="So, my e-mail server setup work really well so I decided so move my main email from Google Apps to a self hosted server instead.I did some research on what tool to use since I really need to bring my mail with me. (note, this will not bring your contacts).
I looked at imapcopy but some people were having issues with it and recommended imapsync instead. This is a software the creator charges €50 for but this blog recommended using this site to download it for free. And as far as I can see, it seems legit. You decide.
The first step is to setup the server to start receive mail for that new domain. Login to postfixadmin and add a new domain and a new mailbox for your user. Make a DKIM-key-pair. Routing new incoming email is easily done in the DNS by changing the MX records. Remember to look over your SPF-record as well, to see if it’s still ok after the switch.
&quot;&gt;">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Transfer e-mail from GMail to another IMAP server"/>
  <meta property="og:site_name" content="oskarhane.com"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="oskarhane.com" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">oskarhane.com</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-03-21T16:09:10.000Z"><a href="/transfer-e-mail-from-gmail-to-another-imap-server/">2013-03-21</a></time>
      
      
  
    <h1 class="title">Transfer e-mail from GMail to another IMAP server</h1>
  

    </header>
    <div class="entry">
      
        <p>So, my e-mail server setup work really well so I decided so move my main email from Google Apps to a self hosted server instead.<br>I did some research on what tool to use since I really need to bring my mail with me. (note, this will not bring your contacts).</p>
<p>I looked at <a href="http://code.google.com/p/imapcopy/" target="_blank" rel="external">imapcopy</a> but some people were having issues with it and recommended <a href="http://imapsync.lamiral.info" target="_blank" rel="external">imapsync</a> instead. This is a software the creator charges €50 for but <a href="http://www.joshualyman.com/2011/05/migrating-from-private-imap-to-google-apps-email/" target="_blank" rel="external">this blog</a> recommended using <a href="https://fedorahosted.org/imapsync/" target="_blank" rel="external">this site</a> to download it for free. And as far as I can see, it seems legit. You decide.</p>
<p>The first step is to setup the server to start receive mail for that new domain. Login to <a href="/gui-for-your-mail-server-postfixadmin/">postfixadmin</a> and add a new domain and a new mailbox for your user. <a href="/sign-your-outgoing-email-with-dkim/">Make a DKIM</a>-key-pair. Routing new incoming email is easily done in the DNS by changing the MX records. Remember to look over your SPF-record as well, to see if it’s still ok after the switch.</p>
<h2 id="<!-_more_->"><a id="more"></a></h2><h2 id="Step_1_-_Dependencies">Step 1 - Dependencies</h2><p>imapsync is a Perl script which depends on some tools. Follow these instructions to install what you need to run imapsync.</p>
<pre><code>wget http://search.cpan.org/CPAN/authors/id/D/DJ/DJKERNEN/Mail-IMAPClient-2.2.9.tar.gz
tar xzf Mail-IMAPClient-2.2.9.tar.gz
cd Mail-IMAPClient-2.2.9
perl Makefile.PL
make <span class="operator"><span class="keyword">install</span>

aptitude <span class="keyword">install</span>  libmail-imapclient-perl
aptitude <span class="keyword">install</span>  libdigest-<span class="keyword">md5</span>-file-perl
aptitude <span class="keyword">install</span>  libterm-readkey-perl
aptitude <span class="keyword">install</span>  libio-socket-ssl-perl
aptitude <span class="keyword">install</span>  libfile-spec-perl
aptitude <span class="keyword">install</span>  libdigest-hmac-perl</span>
</code></pre><h2 id=""> </h2><h2 id="Step_2_-_Install_imapsync">Step 2 - Install imapsync</h2><p>Install imapsync</p>
<pre><code>wget http:<span class="comment">//git.fedorahosted.org/cgit/imapsync.git/snapshot/imapsync-1.525.tar.gz</span>
tar xvzf imapsync-<span class="number">1.525</span><span class="class">.tar</span><span class="class">.gz</span>
cd imapsync-<span class="number">1.525</span><span class="class">.tar</span><span class="class">.gz</span>
make install
</code></pre><h2 id="-1"> </h2><h2 id="Step_3_-_Test_the_connection_to_both_mailboxes">Step 3 - Test the connection to both mailboxes</h2><p>Testing the sync</p>
<pre><code><span class="id">#the</span> <span class="tag">command</span> <span class="tag">is</span> <span class="tag">imapsync</span> <span class="tag">--host1</span> <span class="tag">from_host</span><span class="class">.com</span> <span class="tag">--host2</span> <span class="tag">to_host</span><span class="class">.com</span>

<span class="id">#this</span> <span class="tag">command</span>, <span class="keyword">when</span> using --dry <span class="keyword">and</span> --justfolders is just testing <span class="keyword">and</span> actually <span class="keyword">not</span> creating <span class="keyword">and</span> moving mail
#also, <span class="keyword">when</span> using Gmail as the <span class="string">'from'</span> server we exclude All Mail since it's just copies <span class="keyword">and</span> a mess. Your inbox <span class="keyword">and</span> other folders will have the mail.
imapsync --host1 imap.gmail.com --user1 old<span class="variable">@mailbox</span>.com --password1 MASKED --host2 new.mailserver.com --user2 new<span class="variable">@mailserver</span>.com --password2 MASKED --syncinternaldates --ssl1 -ssl2 --noauthmd5 --split1 <span class="number">100</span> --split2 <span class="number">100</span> --exclude All Mail --dry --justfolders
</code></pre><h2 id="-2"> </h2><h2 id="Step_4_-_Sync_mailboxes">Step 4 - Sync mailboxes</h2><p>Doing the sync.<br>Run the exact same command as in Step 3 if everything looked good. Just omit the ‘—dry’ and ‘—justfolders’ flags.</p>
<pre><code><span class="comment">imapsync</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">host1</span> <span class="comment">imap</span><span class="string">.</span><span class="comment">gmail</span><span class="string">.</span><span class="comment">com</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">user1</span> <span class="comment">old@mailbox</span><span class="string">.</span><span class="comment">com</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">password1</span> <span class="comment">MASKED</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">host2</span> <span class="comment">new</span><span class="string">.</span><span class="comment">mailserver</span><span class="string">.</span><span class="comment">com</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">user2</span> <span class="comment">new@mailserver</span><span class="string">.</span><span class="comment">com</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">password2</span> <span class="comment">MASKED</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">syncinternaldates</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">ssl1</span> <span class="literal">-</span><span class="comment">ssl2</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">noauthmd5</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">split1</span> <span class="comment">100</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">split2</span> <span class="comment">100</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">exclude</span> <span class="comment">All</span> <span class="comment">Mail</span>
</code></pre><p>And now we wait. This can take a few hours if you have a huge mailbox. Mine was about 8k messages and took two hours.</p>
<p>We also have to wait for the DNS changes to go through so email can still come to your old inbox. Usually takes about a few hours, but can take up to 48h.<br>No mail are lost during this time.</p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/Server-Side/">Server Side</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="widget tag">
  <img width="100%" height="auto" src="/post_img/2013/02/4f339050f44c11e1a3461231381315e1_7.jpg">
    <h3 class="title"> MY LIFE CONSISTS OF…</h3>
      <p class="entry">
        ... coding, family, humor, and general whining about stuff that's not done right.
        <br>
        I'm an introvert (<a href="http://www.typelogic.com/intp.html">INTP</a>) who loves to program, build stuff, and solve problems.
        <br>Works @ <a href="http://neo4j.com/">Neo4j</a>.
        <br>I can be reached at <a href="http://twitter.com/oskarhane">@oskarhane</a>, &nbsp; <a href="http://www.facebook.com/ohane">ohane</a>
        &nbsp; and &nbsp;
        <a href="mailto:blog@oskrhane.com">blog@oskarhane.com</a>.
      </p>
</div>

  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/angular-bootstrap-jade-stylus-coffeescript-boilerplate-webapp-with-yeoman/">Angular - Bootstrap - Jade - Stylus - CoffeeScript boilerplate webapp with Yeoman</a>
      </li>
    
      <li>
        <a href="/again-add-authorization-header-to-angularjs-http/">Again: Add Authorization header to AngularJS $http</a>
      </li>
    
      <li>
        <a href="/add-authorization-header-to-angularjs-http/">Add Authorization header to AngularJS $http</a>
      </li>
    
      <li>
        <a href="/create-a-nested-array-recursively-in-coffeescript/">Create a nested array recursively in CoffeeScript</a>
      </li>
    
      <li>
        <a href="/angularjs-watch-and-timeout/">AngularJS: $watch and $timeout</a>
      </li>
    
      <li>
        <a href="/neo4j-docker-image/">Neo4j Docker Image</a>
      </li>
    
      <li>
        <a href="/two-factor-auth-for-wordpress-5000-downloads/">Two Factor Auth for Wordpress &gt; 5000 downloads</a>
      </li>
    
      <li>
        <a href="/today-im-joining-the-neo4j-team/">Today I&#39;m joining the Neo4j team!</a>
      </li>
    
      <li>
        <a href="/note-to-self-on-updating-wordpress-plugins-via-git-svn/">Note to self on updating Wordpress plugins via git-svn</a>
      </li>
    
      <li>
        <a href="/use-your-synology-as-a-local-dns-cache/">Use your Synology as a local DNS cache</a>
      </li>
    
      <li>
        <a href="/maker-how-i-did-a-fishing-lure-jerk-bait/">Make:r - How I did a fishing lure / jerk bait </a>
      </li>
    
      <li>
        <a href="/angular-js-filter-to-make-urls-in-text-clickable/">Angular.JS filter to make url:s in text clickable</a>
      </li>
    
      <li>
        <a href="/proxy-app-a-native-proxy-for-os-x/">Proxy.app - A native proxy for OS X</a>
      </li>
    
      <li>
        <a href="/does-that-html5-css3-thing-work-in/">Does that HTML5/ CSS3 thing work in ...?</a>
      </li>
    
      <li>
        <a href="/docker-image-wordpress-nginx-ssh-updated/">Docker image &quot;Wordpress NGiNX SSH&quot; updated</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/BitCoin/">BitCoin</a><small>2</small></li>
  
    <li><a href="/tags/Client-Side/">Client Side</a><small>34</small></li>
  
    <li><a href="/tags/Coding/">Coding</a><small>54</small></li>
  
    <li><a href="/tags/Crypto/">Crypto</a><small>11</small></li>
  
    <li><a href="/tags/Docker/">Docker</a><small>4</small></li>
  
    <li><a href="/tags/Food/">Food</a><small>2</small></li>
  
    <li><a href="/tags/General/">General</a><small>20</small></li>
  
    <li><a href="/tags/Hacks/">Hacks</a><small>17</small></li>
  
    <li><a href="/tags/Humor/">Humor</a><small>5</small></li>
  
    <li><a href="/tags/Impressive/">Impressive</a><small>13</small></li>
  
    <li><a href="/tags/Node-js/">Node.js</a><small>11</small></li>
  
    <li><a href="/tags/PHP/">PHP</a><small>5</small></li>
  
    <li><a href="/tags/Raspberry-Pi/">Raspberry Pi</a><small>5</small></li>
  
    <li><a href="/tags/Server-Side/">Server Side</a><small>59</small></li>
  
    <li><a href="/tags/Training/">Training</a><small>7</small></li>
  
    <li><a href="/tags/Whine/">Whine</a><small>6</small></li>
  
    <li><a href="/tags/WordPress/">WordPress</a><small>17</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.hanehub.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.hanehub.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

</body>
</html>